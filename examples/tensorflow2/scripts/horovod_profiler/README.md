#### Instructions to run the example

This example is to train a resnet50 model with cifar10/imagenette dataset in multi-gpu mode using horovod. The example has been written with the purpose of profiling the training job using horovod's timeline and tenslorflow's tensorboard plugin. The script has not been tuned for convergence and accuracy.

Packages to install before running the training script -
```bash
pip install tf-nightly
pip tb-nightly tensorboard_plugin_profile
HOROVOD_GPU_ALLREDUCE=NCCL HOROVOD_GPU_BROADCAST=NCCL HOROVOD_WITH_TENSORFLOW pip install horovod
```

For full details of horovod installation, see here - [https://github.com/horovod/horovod#install](https://github.com/horovod/horovod#install)

We will profile the above trainin job using [Horovod Timeline](https://github.com/horovod/horovod/blob/master/docs/timeline.rst) and Tensorboard.

To enable horovod timeline we need to set these two environment variables -

```bash
export HOROVOD_TIMELINE="timeline.json"
export HOROVOD_TIMELINE_MARK_CYCLES=1
```

The first environment variable describes the name of the trace file that horovod will generate. The second environment variable is optional and needed only if you want to include cycle markers in the trace file.

Once the environment variables are set, the training job is launched with the following command

```bash
mpirun -np 8 python3 tf2_resnet_keras.py
```

The above command launches the training job and the argument `-np 8` tells the system to launch the job with 8 processes. The training script has the logic to pin each of these processes to the 8 GPUs on the system.

The training script once completed will produce two artifacts in the local folder -
 - a trace file named `timeline.json` which will contain the information captured by horovod timeline.
 - a folder named `logs` that contains tfevents file generated by tensorboard.

To view the trace file `timeline.json` open a Google Chrome tab and type `chrome://tracing` in the address bar and load the above json file in the window.

To view the contents of the `logs` folder, open a terminal tab and type `tensorboard --logdir <path to logs folder>`.
